<template>
    <lightning-card title="Account Manager"  icon-name="action:new_account">
<!-- <template lwc:if={isTrue}>
            <p>This is a test1</p>
        </template>
        <template lwc:elseif={isFalse}>
            <p>This is a test2</p>
        </template>
       <template lwc:else>
            <p>This is a test3</p>
        </template>-->
       
        <div class="slds-text-align_left">
            <lightning-button variant="success" label="Create an Account" 
            title="Create an Account" onclick={handleToggle} 
            class="slds-m-left_x-small"
            ></lightning-button>
        </div>

        <template lwc:if={showCreateForm}>
        <div class="slds-p-around_medium">
            <lightning-input type="text" name="Name" value={newAccount.Name} label="Enter Name" onchange={handleInputs} required
            placeholder="Enter Full Name"></lightning-input>
            <lightning-input name="Phone" value={newAccount.Phone} label="Enter Phone" onchange={handleInputs} required></lightning-input>
           
            <lightning-combobox
            name="Type"
            label="Type"
            value={newAccount.Type}
            placeholder="Select Type"
            options={typeOptions}
            onchange={handleInputs} ></lightning-combobox>

            <lightning-combobox
            name="Industry"
            label="Industry"
            value={newAccount.Industry}
            placeholder="Select Industry"
            options={industryOptions}
            onchange={handleInputs} ></lightning-combobox>

        </div>

        <div class="slds-text-align_right">
            <lightning-button variant="success" label="Save An Account" 
            title="Successful action" onclick={handleClickSave} 
            class="slds-m-left_x-small"
            ></lightning-button>
        </div>

          </template>

          <div class="slds-m-top_medium">
            <lightning-button variant="success" label="Update Account" 
            title="Update Account" onclick={handleToggle} 
            class="slds-m-left_x-small"
            ></lightning-button>
        </div>

        <template lwc:if={showUpdateForm}>
          
            <ul>
                <template for:each={accounts} for:item="account">
                    <li key={account.Id}>
                        <lightning-input type="checkbox"
                                         label={account.Name}
                                         value={account.Id}
                                         onchange={handleCheckboxChange}>
                        </lightning-input>
                    </li>
                </template>
            </ul><div class="slds-p-around_medium">
                <lightning-input type="text" name="Name" value={newAccount.Name} label="Enter Name" onchange={handleInputs} required
                placeholder="Enter Full Name"></lightning-input>
                <lightning-input name="Phone" value={newAccount.Phone} label="Enter Phone" onchange={handleInputs} required></lightning-input>
              
                <lightning-combobox
                name="Type"
                label="Type"
                value={newAccount.Type}
                placeholder="Select Type"
                options={typeOptions}
                onchange={handleInputs} ></lightning-combobox>
    
                <lightning-combobox
                name="Industry"
                label="Industry"
                value={newAccount.Industry}
                placeholder="Select Industry"
                options={industryOptions}
                onchange={handleInputs} ></lightning-combobox>
    
            </div>
            <div class="slds-text-align_right">
                <lightning-button variant="success" label="Update An Account" 
                title="Successful action" onclick={handleClickUpdate} 
                class="slds-m-left_x-small"
                ></lightning-button>
            </div>
            
        </template>

        <lightning-datatable
                key-field="Id"
                data={accounts}import { LightningElement, track } from 'lwc';
import getAccounts from '@salesforce/apex/AccountManagementController.getAccounts';
import createAccount from '@salesforce/apex/AccountManagementController.createAccount';
import updateAccount from '@salesforce/apex/AccountManagementController.updateAccount';
import { ShowToastEvent } from 'lightning/platformShowToastEvent';
import { refreshApex } from '@salesforce/apex';

export default class AccountManagement extends LightningElement {
    @track accounts = []; // Accounts data to display in datatable
    @track typeOptions = [];
    @track industryOptions = [];
    @track selectedAccounts = [];
    @track newAccount = {
        Name: '',
        Industry: '',
        Phone: '',
        Type: ''
    };
    @track updatedFields = {};
    @track hasAccounts = false;  // New flag to control when the datatable is visible
    @track draftValues = [];

    // Define the columns for the datatable
    columns = [
        { label: 'Account Name', fieldName: 'Name', editable: true },
        { label: 'Phone', fieldName: 'Phone', type: 'phone', editable: true },
        { label: 'Account Type', fieldName: 'Type', type: 'text', editable: true },
        { label: 'Industry', fieldName: 'Industry', type: 'text', editable: true }
    ];

    // Method to fetch accounts when triggered (e.g., by a button click)
    handleFetchAccounts() {
        getAccounts()
            .then(result => {
                this.accounts = result;
                this.hasAccounts = this.accounts.length > 0; // Show datatable if there are accounts
            })
            .catch(error => {
                this.showToast('Error', error.body.message, 'error');
            });
    }

    // Method to save edited account rows in the datatable
    handleSave(event) {
        const updatedFields = event.detail.draftValues; // Capture the updated fields from the draft
        updateAccount({ updatedAccountList: updatedFields })
            .then(() => {
                this.showToast('Success', 'Accounts updated successfully', 'success');
                this.draftValues = []; // Clear draft values after save
                return refreshApex(this.accountsResult); // Refresh the account list to reflect changes
            })
            .catch(error => {
                this.showToast('Error', error.body.message, 'error');
            });
    }

    // Utility method to show toast notifications
    showToast(title, message, variant) {
        const event = new ShowToastEvent({
            title,
            message,
            variant
        });
        this.dispatchEvent(event);
    }
}

                columns={columns}
                show-row-number-column
                onrowselection={handleRowSelection}
                selected-rows={selectedAccountIds}
                onsave={handleSave}
                draft-values={draftValues}
               	>
                
        </lightning-datatable>
    </lightning-card>
</template>